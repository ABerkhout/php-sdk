<p><?php
define('SDK_ROOT', dirname(dirname(<strong>FILE</strong>)));</p>

<p>function findExamples() {
  return glob(SDK_ROOT.'/example/*.php');
}</p>

<p>function parseExample($file) {
  $php = file<em>get</em>contents($file);
  preg_match('/\/*(.+?)*\/\n(.+)/s', $php, $match);
  list(, $markdown, $code) = $match;</p>

<p>$code = join("\n", array(
    '<?php',
    $code
  ));
  $code = preg_replace('/^.+$/m', '    $0', $code);
  return $markdown."\n".$code;
}</p>

<p>$examples = array();
$files = findExamples();
foreach ($files as $file) {
  $example = parseExample($file);
  $examples[] = $example;
}</p>

<p>$readmePath = SDK<em>ROOT.'/Readme.md';
$readme = file</em>get_contents($readmePath);
$exampleDocs = join("\n", $examples);</p>

<p>$readme = preg_replace(
  '/(generated by: make docs[^\n]+\n).+(\n<!--)/is',
  '$1'.$exampleDocs.'$2',
  $readme
);</p>

<p>file<em>put</em>contents($readmePath, $readme);</p>
